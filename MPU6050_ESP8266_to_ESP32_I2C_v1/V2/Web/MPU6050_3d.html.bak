<!DOCTYPE html>
<html>
<head>
    <title>MPU6050 VR Tracker</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            background: rgba(255,255,255,0.95); 
            padding: 20px; 
            border-radius: 15px; 
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        .header { 
            text-align: center; 
            margin-bottom: 30px;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 20px;
            border-radius: 10px;
        }
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        .panel {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #4CAF50;
        }
        .visualization-panel {
            grid-column: 1 / -1;
            background: #2c3e50;
            color: white;
            padding: 20px;
            border-radius: 10px;
        }
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }
        .btn {
            padding: 12px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
        }
        .btn-primary { background: #4CAF50; color: white; }
        .btn-warning { background: #ff9800; color: white; }
        .btn-danger { background: #f44336; color: white; }
        .btn-info { background: #2196F3; color: white; }
        .btn-secondary { background: #6c757d; color: white; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
        
        .data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .data-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
        }
        .data-value {
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0;
        }
        .data-label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
        }
        .direction-positive { color: #4CAF50; }
        .direction-negative { color: #f44336; }
        .direction-zero { color: #ff9800; }
        
        .cube-container {
            width: 300px;
            height: 300px;
            margin: 20px auto;
            perspective: 1000px;
        }
        .cube {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.1s ease-out;
        }
        .face {
            position: absolute;
            width: 300px;
            height: 300px;
            border: 3px solid #34495e;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            color: white;
            background: rgba(52, 152, 219, 0.8);
        }
        .front  { transform: rotateY(0deg) translateZ(150px); background: rgba(231, 76, 60, 0.8); }
        .back   { transform: rotateY(180deg) translateZ(150px); background: rgba(52, 152, 219, 0.8); }
        .right  { transform: rotateY(90deg) translateZ(150px); background: rgba(46, 204, 113, 0.8); }
        .left   { transform: rotateY(-90deg) translateZ(150px); background: rgba(155, 89, 182, 0.8); }
        .top    { transform: rotateX(90deg) translateZ(150px); background: rgba(241, 196, 15, 0.8); }
        .bottom { transform: rotateX(-90deg) translateZ(150px); background: rgba(230, 126, 34, 0.8); }
        
        .connection-status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 15px;
            border-radius: 20px;
            font-weight: bold;
            z-index: 1000;
        }
        .connected { background: #4CAF50; color: white; }
        .disconnected { background: #f44336; color: white; }
        .config { background: #ff9800; color: white; }
        
        .config-panel {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        .config-input {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            width: 200px;
            margin-right: 10px;
        }
        .config-label {
            font-weight: bold;
            margin-right: 10px;
            color: #856404;
        }
        
        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .info-section {
            background: #e8f5e8;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #4CAF50;
        }
        
        .notification {
            position: fixed;
            top: 80px;
            right: 20px;
            background: #4CAF50;
            color: white;
            padding: 15px 20px;
            border-radius: 5px;
            z-index: 1001;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            font-weight: bold;
            max-width: 300px;
        }
        
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            .cube-container {
                width: 200px;
                height: 200px;
            }
            .face {
                width: 200px;
                height: 200px;
                font-size: 18px;
            }
            .front  { transform: rotateY(0deg) translateZ(100px); }
            .back   { transform: rotateY(180deg) translateZ(100px); }
            .right  { transform: rotateY(90deg) translateZ(100px); }
            .left   { transform: rotateY(-90deg) translateZ(100px); }
            .top    { transform: rotateX(90deg) translateZ(100px); }
            .bottom { transform: rotateX(-90deg) translateZ(100px); }
        }
    </style>
</head>
<body>
    <div class="connection-status config" id="connectionStatus">
        ‚öôÔ∏è Configure IP
    </div>

    <div class="container">
        <div class="header">
            <h1>üéÆ MPU6050 VR Head Tracker</h1>
            <p>Real-time orientation tracking with 3D visualization</p>
        </div>

        <div class="config-panel" id="configPanel">
            <h3>üîß Configuration</h3>
            <div style="margin: 15px 0;">
                <span class="config-label">Device IP Address:</span>
                <input type="text" class="config-input" id="ipInput" placeholder="192.168.31.110" value="192.168.31.110">
                <button class="btn btn-primary" onclick="saveConfig()">üíæ Save & Connect</button>
                <button class="btn btn-secondary" onclick="loadDefaultIP()">üîÑ Default IP</button>
            </div>
            <div style="font-size: 12px; color: #856404;">
                üí° Enter the IP address of your ESP8266 device with MPU6050 sensor
            </div>
        </div>

        <div class="dashboard">
            <div class="panel">
                <h3>üìä Absolute Orientation</h3>
                <div class="data-grid">
                    <div class="data-card">
                        <div class="data-label">Pitch (X)</div>
                        <div class="data-value" id="absPitch">0.00¬∞</div>
                        <div class="data-label">Front-Back Tilt</div>
                    </div>
                    <div class="data-card">
                        <div class="data-label">Roll (Y)</div>
                        <div class="data-value" id="absRoll">0.00¬∞</div>
                        <div class="data-label">Left-Right Tilt</div>
                    </div>
                    <div class="data-card">
                        <div class="data-label">Yaw (Z)</div>
                        <div class="data-value" id="absYaw">0.00¬∞</div>
                        <div class="data-label">Head Rotation</div>
                    </div>
                </div>
            </div>

            <div class="panel">
                <h3>üéØ Relative to Zero</h3>
                <div class="data-grid">
                    <div class="data-card">
                        <div class="data-label">Pitch</div>
                        <div class="data-value">
                            <span id="relPitch">0.00¬∞</span> <span id="dirPitch" class="direction-zero">‚óè</span>
                        </div>
                    </div>
                    <div class="data-card">
                        <div class="data-label">Roll</div>
                        <div class="data-value">
                            <span id="relRoll">0.00¬∞</span> <span id="dirRoll" class="direction-zero">‚óè</span>
                        </div>
                    </div>
                    <div class="data-card">
                        <div class="data-label">Yaw</div>
                        <div class="data-value">
                            <span id="relYaw">0.00¬∞</span> <span id="dirYaw" class="direction-zero">‚óè</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="visualization-panel">
                <h3>üéÆ 3D Head Orientation</h3>
                <div class="cube-container">
                    <div class="cube" id="cube">
                        <div class="face front">FACE</div>
                        <div class="face back">BACK</div>
                        <div class="face right">RIGHT</div>
                        <div class="face left">LEFT</div>
                        <div class="face top">TOP</div>
                        <div class="face bottom">BOTTOM</div>
                    </div>
                </div>
                
                <div class="data-grid">
                    <div class="data-card">
                        <div class="data-label">Accumulated Pitch</div>
                        <div class="data-value" id="accPitch">0.00¬∞</div>
                    </div>
                    <div class="data-card">
                        <div class="data-label">Accumulated Roll</div>
                        <div class="data-value" id="accRoll">0.00¬∞</div>
                    </div>
                    <div class="data-card">
                        <div class="data-label">Accumulated Yaw</div>
                        <div class="data-value" id="accYaw">0.00¬∞</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="controls">
            <button class="btn btn-primary" onclick="setZeroPoint()">
                üéØ Set Zero Point
            </button>
            <button class="btn btn-warning" onclick="resetZeroPoint()">
                üîÑ Reset Zero
            </button>
            <button class="btn btn-info" onclick="recalibrate()">
                üîß Recalibrate
            </button>
            <button class="btn btn-danger" onclick="resetYaw()">
                üéØ Reset Yaw
            </button>
            <button class="btn btn-info" onclick="resetAccumulated()">
                üìä Reset Accumulated
            </button>
            <button class="btn btn-secondary" onclick="showConfig()">
            ‚öôÔ∏è Change IP
            </button>
        </div>

        <div class="info-section">
            <h4>üìà System Status</h4>
            <div class="data-grid">
                <div class="data-card">
                    <div class="data-label">Device State</div>
                    <div class="data-value" id="deviceState">-</div>
                </div>
                <div class="data-card">
                    <div class="data-label">WiFi Signal</div>
                    <div class="data-value" id="wifiSignal">-</div>
                </div>
                <div class="data-card">
                    <div class="data-label">Zero Point</div>
                    <div class="data-value" id="zeroStatus">-</div>
                </div>
                <div class="data-card">
                    <div class="data-label">Idle Mode</div>
                    <div class="data-value" id="idleStatus">-</div>
                </div>
            </div>
        </div>

        <div class="info-section">
            <h4>üí° How to Use</h4>
            <ul>
                <li><strong>Set Zero Point:</strong> Set current head position as reference</li>
                <li><strong>Recalibrate:</strong> Fix sensor drift by recalibrating gyro</li>
                <li><strong>Reset Yaw:</strong> Reset yaw rotation to zero</li>
                <li><strong>Direction Indicators:</strong> Green ‚óè = positive, Red ‚óè = negative, Orange ‚óè = stationary</li>
                <li><strong>Idle Mode:</strong> Yaw automatically increases when device is stationary</li>
                <li><strong>Change IP:</strong> Use the configuration panel to set your device's IP address</li>
            </ul>
        </div>

        <div class="info-section">
            <h4>üåê Connection Info</h4>
            <div class="data-grid">
                <div class="data-card">
                    <div class="data-label">Current IP</div>
                    <div class="data-value" id="currentIP">-</div>
                </div>
                <div class="data-card">
                    <div class="data-label">WebSocket Port</div>
                    <div class="data-value">81</div>
                </div>
                <div class="data-card">
                    <div class="data-label">HTTP Port</div>
                    <div class="data-value">80</div>
                </div>
                <div class="data-card">
                    <div class="data-label">Reconnect Attempts</div>
                    <div class="data-value" id="reconnectCount">0</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let ws = null;
        let cube = document.getElementById('cube');
        let connectionStatus = document.getElementById('connectionStatus');
        let configPanel = document.getElementById('configPanel');
        let reconnectAttempts = 0;
        const maxReconnectAttempts = 10;
        let currentIP = '';
        
        // Orientation data history for smoothing
        let orientationHistory = {
            pitch: [],
            roll: [],
            yaw: []
        };
        
        // Load saved IP from localStorage
        function loadSavedIP() {
            const savedIP = localStorage.getItem('mpu6050_ip');
            if (savedIP) {
                document.getElementById('ipInput').value = savedIP;
                currentIP = savedIP;
                document.getElementById('currentIP').textContent = savedIP;
            } else {
                // Use default IP
                currentIP = '192.168.31.110';
                document.getElementById('currentIP').textContent = currentIP;
            }
        }
        
        function saveConfig() {
            const ipInput = document.getElementById('ipInput').value.trim();
            
            // Basic IP validation
            if (!ipInput) {
                showNotification('Please enter an IP address', 'error');
                return;
            }
            
            // Simple IP format validation
            const ipRegex = /^(\d{1,3}\.){3}\d{1,3}$/;
            if (!ipRegex.test(ipInput)) {
                showNotification('Please enter a valid IP address', 'error');
                return;
            }
            
            // Save to localStorage
            localStorage.setItem('mpu6050_ip', ipInput);
            currentIP = ipInput;
            document.getElementById('currentIP').textContent = currentIP;
            
            showNotification(`IP address saved: ${ipInput}`, 'success');
            
            // Close config panel and connect
            configPanel.style.display = 'none';
            connectWebSocket();
        }
        
        function loadDefaultIP() {
            document.getElementById('ipInput').value = '192.168.31.110';
            showNotification('Default IP loaded', 'info');
        }
        
        function showConfig() {
            configPanel.style.display = 'block';
            // Disconnect if connected
            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.close();
            }
        }
        
        function connectWebSocket() {
            if (!currentIP) {
                showNotification('Please configure IP address first', 'error');
                configPanel.style.display = 'block';
                return;
            }
            
            const wsUrl = `ws://${currentIP}:81`;
            
            connectionStatus.textContent = 'üü° Connecting...';
            connectionStatus.className = 'connection-status config';
            
            try {
                ws = new WebSocket(wsUrl);
                
                ws.onopen = function() {
                    console.log(`‚úÖ WebSocket connected to ${currentIP}`);
                    connectionStatus.textContent = `üü¢ Connected to ${currentIP}`;
                    connectionStatus.className = 'connection-status connected';
                    reconnectAttempts = 0;
                    document.getElementById('reconnectCount').textContent = '0';
                    showNotification(`Connected to ${currentIP}`, 'success');
                };
                
                ws.onmessage = function(event) {
                    try {
                        const data = JSON.parse(event.data);
                        handleSensorData(data);
                    } catch (e) {
                        console.error('Error parsing sensor data:', e);
                    }
                };
                
                ws.onclose = function(event) {
                    console.log(`‚ùå WebSocket disconnected from ${currentIP}`);
                    connectionStatus.textContent = `üî¥ Disconnected from ${currentIP}`;
                    connectionStatus.className = 'connection-status disconnected';
                    
                    if (reconnectAttempts < maxReconnectAttempts) {
                        reconnectAttempts++;
                        const delay = Math.min(1000 * reconnectAttempts, 10000);
                        console.log(`Reconnecting in ${delay}ms... (attempt ${reconnectAttempts})`);
                        document.getElementById('reconnectCount').textContent = reconnectAttempts;
                        
                        setTimeout(connectWebSocket, delay);
                    } else {
                        showNotification(`Failed to connect after ${maxReconnectAttempts} attempts`, 'error');
                    }
                };
                
                ws.onerror = function(error) {
                    console.error('WebSocket error:', error);
                    showNotification(`Connection error to ${currentIP}`, 'error');
                };
                
            } catch (error) {
                console.error('Failed to create WebSocket:', error);
                showNotification('Failed to create WebSocket connection', 'error');
            }
        }
        
        function handleSensorData(data) {
            if (data.type === 'sensorData') {
                updateDashboard(data);
                update3DVisualization(data);
                updateSystemStatus(data);
            } else if (data.type === 'status') {
                console.log('System message:', data.message);
                showNotification(data.message, 'info');
            } else if (data.type === 'zeroInfo') {
                console.log('Zero point updated:', data);
                showNotification('Zero point set successfully', 'success');
            } else if (data.type === 'zeroReset') {
                console.log('Zero point reset');
                showNotification('Zero point reset', 'info');
            } else if (data.type === 'pong') {
                // Ping-pong response, no need to show
                console.log('Pong received');
            }
        }
        
        function updateDashboard(data) {
            // Update absolute orientation
            document.getElementById('absPitch').textContent = data.absPitch.toFixed(1) + '¬∞';
            document.getElementById('absRoll').textContent = data.absRoll.toFixed(1) + '¬∞';
            document.getElementById('absYaw').textContent = data.absYaw.toFixed(1) + '¬∞';
            
            // Update relative orientation
            document.getElementById('relPitch').textContent = data.pitch.toFixed(1) + '¬∞';
            document.getElementById('relRoll').textContent = data.roll.toFixed(1) + '¬∞';
            document.getElementById('relYaw').textContent = data.yaw.toFixed(1) + '¬∞';
            
            // Update accumulated angles
            document.getElementById('accPitch').textContent = data.accPitch.toFixed(1) + '¬∞';
            document.getElementById('accRoll').textContent = data.accRoll.toFixed(1) + '¬∞';
            document.getElementById('accYaw').textContent = data.accYaw.toFixed(1) + '¬∞';
            
            // Update direction indicators
            updateDirectionIndicator('dirPitch', data.dirPitch);
            updateDirectionIndicator('dirRoll', data.dirRoll);
            updateDirectionIndicator('dirYaw', data.dirYaw);
        }
        
        function updateDirectionIndicator(elementId, direction) {
            const element = document.getElementById(elementId);
            element.textContent = direction === 1 ? '‚Üó' : direction === -1 ? '‚Üô' : '‚óè';
            element.className = direction === 1 ? 'direction-positive' : 
                              direction === -1 ? 'direction-negative' : 'direction-zero';
        }
        
        function update3DVisualization(data) {
            // Apply smooth rotation to the cube with corrected logic
            const smoothPitch = smoothValue('pitch', data.pitch);
            const smoothRoll = smoothValue('roll', data.roll);
            const smoothYaw = smoothValue('yaw', data.yaw);
            
            // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤—Ä–∞—â–µ–Ω–∏—è:
            // - Pitch –≤—Ä–∞—â–∞–µ—Ç –≤–æ–∫—Ä—É–≥ X –æ—Å–∏ (–Ω–∞–∫–ª–æ–Ω –≤–ø–µ—Ä–µ–¥/–Ω–∞–∑–∞–¥)
            // - Yaw –≤—Ä–∞—â–∞–µ—Ç –≤–æ–∫—Ä—É–≥ Y –æ—Å–∏ (–ø–æ–≤–æ—Ä–æ—Ç –≥–æ–ª–æ–≤—ã –≤–ª–µ–≤–æ/–≤–ø—Ä–∞–≤–æ)  
            // - Roll –≤—Ä–∞—â–∞–µ—Ç –≤–æ–∫—Ä—É–≥ Z –æ—Å–∏ (–Ω–∞–∫–ª–æ–Ω –≥–æ–ª–æ–≤—ã –≤–ª–µ–≤–æ/–≤–ø—Ä–∞–≤–æ)
            
            // –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –≤—Ä–∞—â–µ–Ω–∏—è –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è:
            // 1. –°–Ω–∞—á–∞–ª–∞ Yaw (–ø–æ–≤–æ—Ä–æ—Ç –≥–æ–ª–æ–≤—ã)
            // 2. –ó–∞—Ç–µ–º Pitch (–Ω–∞–∫–ª–æ–Ω –≤–ø–µ—Ä–µ–¥/–Ω–∞–∑–∞–¥)
            // 3. –ù–∞–∫–æ–Ω–µ—Ü Roll (–Ω–∞–∫–ª–æ–Ω –≤–±–æ–∫)
            
            cube.style.transform = 
                `rotateY(${smoothYaw}deg) rotateX(${smoothPitch}deg) rotateZ(${smoothRoll}deg)`;
            
            // –¢–µ–ø–µ—Ä—å –ø—Ä–∏ YAW=0 –∏ PITCH=90 FACE —Å–º–æ—Ç—Ä–∏—Ç –≤–≤–µ—Ä—Ö
            // –ü—Ä–∏ YAW=90 –∏ PITCH=90 FACE —Ç–∞–∫–∂–µ —Å–º–æ—Ç—Ä–∏—Ç –≤–≤–µ—Ä—Ö (–∞ –Ω–µ RIGHT)
        }
        
        function smoothValue(axis, value) {
            // Add new value to history
            orientationHistory[axis].push(value);
            
            // Keep only last 5 values
            if (orientationHistory[axis].length > 5) {
                orientationHistory[axis].shift();
            }
            
            // Calculate average
            const sum = orientationHistory[axis].reduce((a, b) => a + b, 0);
            return sum / orientationHistory[axis].length;
        }
        
        function updateSystemStatus(data) {
            // Update device state
            document.getElementById('deviceState').textContent = 
                data.idle ? 'Idle' : 'Active';
            document.getElementById('deviceState').style.color = 
                data.idle ? '#ff9800' : '#4CAF50';
            
            // Update idle status
            document.getElementById('idleStatus').textContent = 
                data.idle ? 'Yes' : 'No';
            document.getElementById('idleStatus').style.color = 
                data.idle ? '#ff9800' : '#666';
            
            // Update zero point status
            if (data.zeroSet) {
                document.getElementById('zeroStatus').textContent = 'Set';
                document.getElementById('zeroStatus').style.color = '#4CAF50';
            } else {
                document.getElementById('zeroStatus').textContent = 'Not Set';
                document.getElementById('zeroStatus').style.color = '#f44336';
            }
            
            // Update WiFi signal if available
            if (data.signal) {
                document.getElementById('wifiSignal').textContent = data.signal + ' dBm';
                const signalColor = data.signal > -60 ? '#4CAF50' : data.signal > -70 ? '#ff9800' : '#f44336';
                document.getElementById('wifiSignal').style.color = signalColor;
            }
        }
        
        function setZeroPoint() {
            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify({type: 'setZero'}));
                showNotification('Setting zero point...', 'info');
            } else {
                showNotification('Not connected to sensor', 'error');
            }
        }
        
        function resetZeroPoint() {
            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify({type: 'resetZero'}));
                showNotification('Resetting zero point...', 'info');
            } else {
                showNotification('Not connected to sensor', 'error');
            }
        }
        
        function recalibrate() {
            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify({type: 'recalibrate'}));
                showNotification('Recalibrating gyro... Don\'t move the sensor!', 'warning');
            } else {
                showNotification('Not connected to sensor', 'error');
            }
        }
        
        function resetYaw() {
            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify({type: 'resetYaw'}));
                showNotification('Resetting yaw...', 'info');
            } else {
                showNotification('Not connected to sensor', 'error');
            }
        }
        
        function resetAccumulated() {
            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify({type: 'resetAccumulated'}));
                showNotification('Resetting accumulated angles...', 'info');
            } else {
                showNotification('Not connected to sensor', 'error');
            }
        }
        
        function showNotification(message, type = 'info') {
            // Remove existing notifications
            const existingNotifications = document.querySelectorAll('.notification');
            existingNotifications.forEach(notif => notif.remove());
            
            // Create new notification
            const notification = document.createElement('div');
            notification.textContent = message;
            notification.className = 'notification';
            
            // Set color based on type
            if (type === 'error') {
                notification.style.background = '#f44336';
            } else if (type === 'warning') {
                notification.style.background = '#ff9800';
            } else if (type === 'success') {
                notification.style.background = '#4CAF50';
            } else {
                notification.style.background = '#2196F3';
            }
            
            document.body.appendChild(notification);
            
            // Remove after 3 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 3000);
        }
        
        // Initialize when page loads
        window.addEventListener('load', function() {
            loadSavedIP();
            
            // Show config panel by default if no IP is set
            if (!currentIP) {
                configPanel.style.display = 'block';
            } else {
                // Auto-connect if IP is already configured
                connectWebSocket();
            }
            
            // Set up periodic ping to keep connection alive
            setInterval(() => {
                if (ws && ws.readyState === WebSocket.OPEN) {
                    ws.send(JSON.stringify({
                        type: 'ping',
                        timestamp: Date.now()
                    }));
                }
            }, 30000);
        });
        
        // Reconnect when page becomes visible again
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden && (!ws || ws.readyState !== WebSocket.OPEN)) {
                connectWebSocket();
            }
        });
        
        // Allow Enter key to save config
        document.getElementById('ipInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                saveConfig();
            }
        });
    </script>
</body>
</html>